\pdfbookmark{Общая характеристика работы}{characteristic}             % Закладка pdf
\section*{Общая характеристика работы}

\newcommand{\actuality}{\pdfbookmark[1]{Актуальность}{actuality}\underline{\textbf{\actualityTXT}}}
\newcommand{\progress}{\pdfbookmark[1]{Разработанность темы}{progress}\underline{\textbf{\progressTXT}}}
\newcommand{\aim}{\pdfbookmark[1]{Цели}{aim}\underline{{\textbf\aimTXT}}}
\newcommand{\tasks}{\pdfbookmark[1]{Задачи}{tasks}\underline{\textbf{\tasksTXT}}}
\newcommand{\aimtasks}{\pdfbookmark[1]{Цели и задачи}{aimtasks}\aimtasksTXT}
\newcommand{\novelty}{\pdfbookmark[1]{Научная новизна}{novelty}\underline{\textbf{\noveltyTXT}}}
\newcommand{\influence}{\pdfbookmark[1]{Практическая значимость}{influence}\underline{\textbf{\influenceTXT}}}
\newcommand{\methods}{\pdfbookmark[1]{Методология и методы исследования}{methods}\underline{\textbf{\methodsTXT}}}
\newcommand{\defpositions}{\pdfbookmark[1]{Основные положения, выносимые на защиту}{defpositions}\underline{\textbf{\defpositionsTXT}}}
\newcommand{\reliability}{\pdfbookmark[1]{Достоверность}{reliability}\underline{\textbf{\reliabilityTXT}}}
\newcommand{\probation}{\pdfbookmark[1]{Апробация}{probation}\underline{\textbf{\probationTXT}}}
\newcommand{\contribution}{\pdfbookmark[1]{Личный вклад}{contribution}\underline{\textbf{\contributionTXT}}}
\newcommand{\publications}{\pdfbookmark[1]{Публикации}{publications}\underline{\textbf{\publicationsTXT}}}
\newcommand{\structureandsize}{\pdfbookmark[1]{Структура и объем работы}{structureandsize}\underline{\textbf{\structureandsizeTXT}}}

\input{common/characteristic} % Характеристика работы по структуре во введении и в автореферате не отличается (ГОСТ Р 7.0.11, пункты 5.3.1 и 9.2.1), потому её загружаем из одного и того же внешнего файла, предварительно задав форму выделения некоторым параметрам

%Диссертационная работа была выполнена при поддержке грантов \dots

\underline{\textbf{Структура и объем работы}}

Диссертация состоит из~введения,
четырёх глав, заключения, списков литературы, публикаций автора по теме исследования, рисунков и таблиц. Полный объем диссертации
100~страниц текста с~47~рисунками и~9~таблицами. Список
литературы содержит 74~наименования.

\pdfbookmark{Содержание работы}{description}                          % Закладка pdf
\section*{Содержание работы}

%TODO Введение
Во {\textbf{введении}} обосновывается актуальность работы, изложены её цель, научная новизна и практическая ценность, даны основные характеристики работы, сформулированы положения, выносимые на защиту, личный вклад автора, представлен отчёт об апробации работы и публикациях, содержащих основные результаты.


%TODO Глава 1
В {\textbf{первой}} главе рассматривается проблема повышения разрешения и резкости изображений флуоресцентной микроскопии на основе анализа временной серии снимков образца, подсвеченного стохастически мигающим красителем (пример снимков такой серии приведён на Рис.~\ref{fig:sinopsis-blinking-samples}). Такой подход не требует специального оборудования для получения изображений повышенного разрешения, поэтому в настоящее время получил широкое распространение и продолжает активно развиваться.

\begin{figure}[ht]
	\centerfloat{
		\hfill
		\includegraphics[width=0.18\textwidth]{blinking-1-6a.png}
		\hfill
		\includegraphics[width=0.18\textwidth]{blinking-1-6b.png}
		\hfill
		\includegraphics[width=0.18\textwidth]{blinking-1-6c.png}
		\hfill
		\includegraphics[width=0.18\textwidth]{blinking-1-6d.png}
		\hfill
		\includegraphics[width=0.18\textwidth]{blinking-1-6e.png}
		\hfill
	}
	\caption{Пример серии изображений, полученных с использованием мигающих флуорофоров}
	\label{fig:sinopsis-blinking-samples}
\end{figure}

Используется следующая математическая модель искажения резкого изображения высокого разрешения:

\begin{equation*}
	y_{ij} = \left(Kx+n\right)_{ij},\quad K=DB,
\end{equation*}

\noindent где $x$ "--- исходное резкое изображение высокого разрешения, $y$ "--- наблюдаемое изображение, $K$ "--- оператор размытия и понижения разрешения, действие которого эквивалентно последовательному действию оператора размытия $B$ и оператора понижения разрешения $D$ (производящего, например, усреднение групп соседних пикселей или простое прореживание пиксельной сетки изображения), а $n$ "--- аддитивный шум с нормальным распределением.

Рассматриваемая модель размытия изображения имеет вид свёртки изображения с ядром размытия:

\begin{equation*}
	x^\prime_{i,j} = \left(B \ast x\right)_{i,j} = \sum_{k=-\infty}^{\infty} \sum_{p=-\infty}^{\infty}{B_{k,p}\ x_{i-k,j-p}},
\end{equation*}

\noindent где $x$ "--- исходное резкое изображение, $x^\prime$ "--- искажённое изображение, $B$ "--- ядро размытия (англ.~point spread function, PSF).

Получившее широкое распространение конфокальные лазерные микроскопы позволяют, сканируя образец лазерным лучом, возбуждать молекулы флуорофора в малых областях образца и получать в итоге более чёткое изображение, чем  при подсветке всего образца сразу. Кроме того, флуоресцентное излучение со смежных слоёв образца, находящихся не в фокусе объектива, частично отсекается точечной диафрагмой, расположенной перед приёмником света. Базовая схема такого микроскопа представлена на Рис.~\ref{fig:sinopsis-scanning-microscope-scheme}.

\begin{figure}[ht]
	\centerfloat{
		\includegraphics[height=0.4\textheight]{scanning-microscope-scheme.png}
	}
	\caption{Базовая схема конфокального лазерного сканирующего микроскопа. 1 "--- источник лазерного излучения; 2 "--- дихроичное зеркало, отражающее излучение с определённой длиной волны; 3 "--- механизм управления направлением луча лазера; 4 "--- линза объектива; 5 "--- механизм управления расстоянием от объектива до образца; 6 "--- точечная диафрагма; 7 "--- детектор флуоресцентного излучения.}
	\label{fig:sinopsis-scanning-microscope-scheme}
\end{figure}

Благодаря поточечной подсветке, ядро размытия в лазерном сканирующем микроскопе $PSF_{eff}$ определяется произведением ядра размытия лазерного луча подсветки образца $PSF_{exc}$ и ядра размытия объектива $PSF_{em}$.
% (см.~\cite{weisshart2014basic}). 
Каждое из этих ядер симметрично и задаётся формулами:

\begin{align*}
	&PSF\left(r, r_0\right) = I_0 \cdot \left(\frac{2\cdot J_1\left(v\right)}{v}\right)^2, \\
	&v=\frac{2\cdot\pi\cdot A\cdot\left|r-r_0\right|}{\lambda}, \\
	&J_1(v)=\sum_{n=0}^{\infty}{\left(-1\right)^n\frac{x^{2n+1}}{2^{2n+1}n!\left(n+1\right)!}},
\end{align*}

\noindent где $I_0$ "--- нормирующий множитель, $J_1$ "--- функция Бесселя первого рода первого порядка, $A$ "--- числовая апертура фокусирующей линзы, $r$ "--- точка в плоскости изображения, $r_0$ "--- центр ядра размытия в плоскости изображения, $\lambda$ "--- длина волны лазера подсветки или флуоресцентного излучения.

Итоговое ядро размытия получаемого микроскопом изображения имеет вид $PSF_{eff}\left(r\right)=PSF_{exc}\left(r,r_{0,exc}\right)\cdot PSF_{em}\left(r,r_{0,em}\right)$, где $r$ "--- точка на изображении, $r_{0,exc}$, $r_{0,em}$ "--- центры ядер размытия лазера подсветки и флуоресцентного излучения соответственно (см.~Рис.~\ref{fig:sinopsis-blinking-psf}).

\begin{figure}[ht]
	\centerfloat{
		\includegraphics[width=0.4\textwidth]{blinking-1-1.png}
	}
	\caption{Нормированные профили ядер размытия лазера подсветки ($PSF_{exc}$), объектива ($PSF_{em}$) и микроскопа ($PSF_{eff}$)}
	\label{fig:sinopsis-blinking-psf}
\end{figure}

%В основе разработанного метода лежит предположение о том, что интенсивности пикселей резкого изображения можно рассмотреть как независимые случайные величины, а серию резких изображений "--- как результат серии наблюдений этих случайных величин. Влияние дифракции представлено свёрткой резкого изображения с одним и тем же ядром для всех пикселей и всех кадров, а полученные размытые снимки содержат высокочастотный шум.

На вход разработанного в данной работе алгоритма алгоритма поступает набор размытых и зашумлённых изображений $Y=\left\{y^t\right\}_{t=1}^T$, $y^t\in\mathbb{R}^l$, ему соответствует неизвестный набор резких изображений высокого разрешения $X=\left\{x^t\right\}_{t=1}^T$, $x^t\in\mathbb{R}^n$. Благодаря природе шума, его можно моделировать случайным процессом с нормальным распределением.
%~\cite{gadsden1965some}. 
Поэтому в данном пункте считается, что $y^t \sim N({Kx}^t,\Theta^{-1})$, где $K\in\mathbb{R}^{l \times n}$ "--- оператор свёртки и понижения разрешения (имеет вид матрицы Тёплица с элементами ядра размытия на диагоналях, умноженной на матрицу понижения разрешения слева), а $\Theta\in\mathbb{R}^{n \times n}$ "--- обратная ковариационная матрица шума, диагональная из-за попиксельной независимости шума. Предполагается, что вследствие малого размера молекул флуорофора в каждом пикселе изображения может находиться достаточно много независимо мигающих молекул, чтобы можно было приблизить распределение суммарной яркости точки нормальным распределением: $x^t \sim N(\mu,\Lambda^{-1})$, где $\mu\in\mathbb{R}^n$ "--- средняя по всем кадрам яркость объекта, а $\Lambda\in\mathbb{R}^{n \times n}$ "--- обратная ковариационная матрица мерцания объекта.

Финальным результатом работы алгоритма являются оценки средней яркости образца $\mu$ и диагонали ковариационной матрицы $\Lambda^{-1}$, квадратные корни элементов которой является стандартными отклонениями яркостей точек резких изображений.

Для нахождения апостериорных распределений $\mu$ и $\Lambda$ и матрицы $\Theta$ максимизируется правдоподобие набора кадров $Y$ с помощью аппроксимации среднего поля и EM"~алгоритма: $p\left(Y\middle|\Theta\right) \rightarrow \max_{\Theta}$.
Необходимая для этого совместная плотность распределения $p\left(X,\mu,\Lambda\middle|Y,\Theta\right)$ определяется произведением:

$p\left(X,\mu,\Lambda\middle|Y,\Theta\right)=\frac{p\left(Y\middle|X,\Theta\right)p\left(X\middle|\mu,\Lambda\right)p\left(\mu\right)p\left(\Lambda\right)}{p\left(Y\middle|\Theta\right)}$.

Априорные распределения $p\left(\mu\right)$ и $p\left(\Lambda\right)$ в рамках исследования задаются следующим образом:

\begin{align*}
	&\mu \sim N\left(m_0,\ \eta_0^{-1}I_n\right), \\
	&\Lambda \sim W\left(W_0,\nu_0\right)=\frac{1}{C}\left|\Lambda\right|^\frac{\nu_0-n-1}{2}\exp{\left(-\frac{1}{2}tr\left[W_0^{-1}\Lambda\right]\right)},
\end{align*}

\noindent где $W(\cdots)$ "--- распределение Уишарта, $I_n$ "--- единичная матрица, $m_0\in\mathbb{R}^n$, $\eta_0,\ \nu_0\in\mathbb{R}$ и $W_0\in\mathbb{R}^{n \times n}$ "--- параметры метода, а $C$ "--- нормировочная константа.

Апостериорные распределения $\left\{x^t\right\}_{t=1}^T$, $\mu$ и $\Lambda$ аппроксимируются с помощью нормальных распределений $q_{1,t}\left(x^t\right)$ и $q_2\left(\mu\right)$ и распределения Уишарта $q_3\left(\Lambda\right)$.

Итоговый алгоритм выглядит следующим образом:

\begin{enumerate}[beginpenalty=10000]
	\item Задаются начальные приближения некоторых параметров искомых распределений $\mu$ и $\Lambda$ и матрицу $\Theta$: $\mathbb{E}\mu \gets \mathbb{E}y^t$, $\mathbb{E}\Lambda \gets diag\left(D\left( y^t \right)\right)$, $\Theta \gets \theta I_l$, где $\theta$ "--- эмпирическая оценка шума, выполненная в пустой области изображения.
	
	\item В течение $R$ итераций происходит обновление параметров искомых распределений:
	
	\begin{align*}
		&q_{1,t}\left(x^t\right):\ \Sigma_{x^t} \gets \left(K^\mathrm{T} \Theta K+\mathbb{E}\Lambda\right)^{-1},\ \ \mathbb{E}x^t \gets \Sigma_{x^t} \cdot \left(K^\mathrm{T} \Theta y^t+\mathbb{E}\Lambda\cdot\mathbb{E}\mu\right); \\
		&q_2\left(\mu\right):\ \Sigma_\mu \gets \left(T\cdot\mathbb{E}\Lambda+\eta_0 I_n\right)^{-1},\ \ \mathbb{E}\mu \gets \Sigma_\mu \cdot \left(\mathbb{E}\Lambda\cdot\sum_{t=1}^{T}{\mathbb{E}x^t}+\eta_0 I_nm_0\right); \\
		&q_3\left(\Lambda\right):\ W\left(W^\prime,v^\prime\right),\ v^\prime \gets v_0+T, \\
		&W^\prime \gets \left(W_0^{-1}+\sum_{t=1}^{T}\left[
		\begin{aligned}
			&\Sigma_{x^t} + \mathbb{E}x^t\left(\mathbb{E}x^t\right)^\mathrm{T} - \mathbb{E}x^t\left(\mathbb{E}\mu\right)^\mathrm{T} - \\
			&- \mathbb{E}\mu\left(\mathbb{E}x^t\right)^\mathrm{T} + \Sigma_\mu + \mathbb{E}\mu\left(\mathbb{E}\mu\right)^\mathrm{T}
		\end{aligned}
		\right]\right)^{-1}, \\
		&\mathbb{E}\Lambda \gets v^\prime W^\prime; \\
		%	&\Theta \gets \left(\frac{1}{T}\sum_{t=1}^{T}\left[\left(K\mathbb{E}x^t-y^t\right)\left(K\mathbb{E}x^t-y^t\right)^\mathrm{T}+K\Sigma_{x^t}K^\mathrm{T}\right]\right)^{-1}. \\
		&\Theta_{ii} \gets \left(\frac{1}{T}\sum_{t=1}^{T}\left[\left(\left(K\mathbb{E}x^t - y^t\right)_i\right)^2 + \left(K\Sigma_{x^t}K^\mathrm{T}\right)_{ii}\right]\right)^{-1}.
	\end{align*}
	
\end{enumerate}

В качестве оценок средней яркости образца и карты мерцания его точек используются величины $\mathbb{E}\mu$ и $\left(\mathbb{E}\Lambda\right)^{-1}$ соответственно.

Для тестирования разработанного метода использовались как искусственные, так и экспериментальные данные. Результаты работы алгоритма на реальных данных приведены на Рис.~\ref{fig:sinopsis-blinking}.

\begin{figure}[ht]
	\centerfloat{
		\hfill
		\subcaptionbox[List-of-Figures entry]{Один кадр серии}[0.3\textwidth]{%
			\includegraphics[width=0.2\textwidth]{blinking-1-8a.png}}
		\hfill
		\subcaptionbox{Усреднённое по времени изображение}[0.3\textwidth]{%
			\includegraphics[width=0.2\textwidth]{blinking-1-8b.png}}
		\hfill
		\subcaptionbox{Результат обработки серии изображений}[0.3\textwidth]{%
			\includegraphics[width=0.2\textwidth]{blinking-1-8h.png}}
		\hfill
	}
	\caption{Результат обработки реальной серии снимков предложенным методом}
	\label{fig:sinopsis-blinking}
\end{figure}

Сравнение с рядом существующих алгоритмов показало, что разработанный метод позволяет восстанавливать резкое изображение, его достоинством являются имеющие физический смысл восстановленные яркость и дисперсия яркости точек изображения, а недостатком "--- высокая вычислительная сложность.


%TODO Глава 2
Во {\textbf{второй}} главе рассматривается задача повышения резкости медицинских изображений методом деформации сетки. Проводится поиск оптимальной функции смещения пикселей для этого метода для каждого из трёх модельных ядер размытия, представленных на Рис.~\ref{fig:sinopsis-warping-blur}.

\begin{figure}[ht]
	\centerfloat{
		\hfill
		\subcaptionbox[List-of-Figures entry]{Гауссово ядро (Г)}{%
			\includegraphics[width=0.25\textwidth]{warping-1-3a.png}}
		\hfill
		\subcaptionbox{Круг (К)}{%
			\includegraphics[width=0.25\textwidth]{warping-1-3b.png}}
		\hfill
		\subcaptionbox{Круг с кольцом (КЦ)}{%
			\includegraphics[width=0.25\textwidth]{warping-1-3c.png}}
		\hfill
	}
	\caption{Рассматриваемые во второй главе модели ядер размытия}
	\label{fig:sinopsis-warping-blur}
\end{figure}

В работе используется двумерная функция смещения вида

\begin{equation*}
	\vec{d}\left(x,y\right) = \frac{\sum_{\left(x_e,y_e\right) \in N\left(x,y\right)}{d\left(x_n\right) G_{\widetilde{\sigma}}\left(x_t\right) \vec{g}\left(x_e,y_e\right) }} {\sum_{\left(x_e,y_e\right) \in N\left(x,y\right)}{G_{\widetilde{\sigma}}\left(x_t\right)\lvert \vec{g}\left(x_e,y_e\right) \rvert}}.
\end{equation*}

\noindent где $N\left(x,y\right)$ "--- это множество точек контуров в окрестности т.~$\left(x, y\right)$; $x_n$ и $x_t$ "--- это проекции вектора $\left(x-x_e, y-y_e\right)$ на вектор градиента изображения $\vec{g}\left(x_e,y_e\right)$ и на нормаль к нему соответственно. Весовая функция $G_{\widetilde{\sigma}}\left(x_t\right)$ определяется формулой:

\begin{equation*}
	G_{\widetilde{\sigma}}\left(x\right) = \frac{1}{\widetilde{\sigma} \sqrt{2\pi}} \exp\left(\frac{-x^2}{2\widetilde{\sigma}^2}\right),
\end{equation*}

\noindent где $\widetilde{\sigma}$ "--- настраиваемый параметр, для которого в ходе выполнения исследования использовалось значение, равное $2.5$ параметрам размытия. В качестве основы выступает одномерная функция смещения $d\left(x_n\right)$.

В работе предлагаются две новые модели функции смещения:

\begin{enumerate}[beginpenalty=10000]	
	\item
	$
	\begin{aligned}
		d_2\left(x; a, b, c\right)=\left\{
		\begin{aligned}
			&\frac{c}{a}x,\ \left|x\right|<a,\\
			&c\frac{b-\left|x\right|}{b-a} \cdot sign\left(x\right),\ a\le\left|x\right|<b,\\
			&0,\ \left|x\right|\geq b;
		\end{aligned}
		\right.
	\end{aligned}
	$
	
	\item $d_1\left(x; a, c\right) = d_2\left(x; a, 1.5a, c\right)$,
\end{enumerate}

\noindent а также рассмотрена и использована для оценки повышения эффективности алгоритма модель функции смещения, соответствующая функции близости, предложенной в статье авторов деформационного метода:

$d_0\left(x; s\right)=s\sqrt\pi\left[erf\left(\frac{x}{2s}\right)-erf\left(\frac{x}{s}\right)\right]$, где $erf{\left(x\right)}=\frac{2}{\sqrt\pi}\int_{0}^{x}{e^{-t^2}dt}$.

При этом величина $x$ "--- это расстояние от точки до контура, делённое на параметр ядра размытия, что позволяет масштабировать функцию для разных уровней размытия без изменения самих параметров $a$, $b$, $c$ и $s$.

Поиск оптимальных параметров для каждого ядра размытия проводится путём минимизации показателя RMSE по всем изображениях тестового набора, состоящего из 192 изображений, созданных путём размытия с разной силой естественных изображений из базы TID2013.

Эксперименты показали, что предложенные функции смещения $d_2\left(x\right)$ и $d_1\left(x\right)$ демонстрируют улучшение качества обработки изображений по сравнению с оригинальной функцией $d_0\left(x\right)$, выражаемое в приросте показателя PNSR, в среднем на 27\%. Вариант алгоритма на основе однопараметрической функция смещения $d_1\left(x\right)$ почти не отличается от двухпараметрического варианта качеством результатов, благодаря этому можно использовать его для всех трёх рассмотренных ядер размытия.


%TODO Глава 3
В {\textbf{третьей}} главе исследуется вопрос контроля качества изображений в задаче компьютерной диагностики туберкулёза. Рассматриваются:
\begin{enumerate}[beginpenalty=10000]
	\item задача автоматического определения уровня жёсткости рентгеновского снимка грудной клетки с помощью нейросетевого алгоритма;
	\item влияние предварительной фильтрации обучающей и валидационной выборок на качество работы алгоритма классификации в задаче диагностики туберкулёза лёгких по рентгеновским снимкам грудной клетки.
\end{enumerate}

Процесс обучения нейросетевого алгоритма контроля качества выглядит следующим образом:
\begin{enumerate}[beginpenalty=10000]
	\item предобработка входных данных;
	\item итеративный процесс минимизации функции потерь (функционала, отображающего выходные значения нейросетевой модели в показатель их близости к оптимальным значениям для решения задачи) повторением шагов:
	\begin{enumerate}[beginpenalty=10000]
		\item подача предобработанных выходных данных на вход нейросетевой модели и получение её выходных значений;
		\item получение значения функции потерь для данных выходных значений модели и входных данных;
		\item шаг оптимизации;
		\item замер качества работы алгоритма;
		\item проверка условия ранней остановки процесса минимизации;
	\end{enumerate}
	\item сохранение модели.	
\end{enumerate}

Процесс применения метода состоит из следующих шагов:
\begin{enumerate}[beginpenalty=10000]
	\item предобработка входных данных;
	\item подача предобработанных выходных данных на вход нейросетевой модели и получение её выходных значений;
\end{enumerate}

При решении задачи были использованы 2 набора рентгенограмм грудной клетки, снятых во фронтальной проекции: собранный в сотрудничестве с медиками из НПЦ~<<Фтизиатрия>> им. Е.Н.~Андреева в г. Якутск набор применялся для обучения нейросетевой модели для метода определения жёсткости рентгенограмм; набор, сформированный из двух наиболее часто используемых при разработке методов компьютерной диагностики туберкулёза лёгких общедоступных наборов рентгенограмм, применялся для оценки качества работы разработанного алгоритма на снимках, сделанных в других медицинских учреждениях, на другом оборудовании и при других условиях. Аннотирование обоих использованных наборов проводилось врачом-рентгенологом из НПЦ~<<Фтизиатрия>> им. Е.Н.~Андреева, каждому изображению ставился в соответствие его уровень жёсткости, выраженный числом отчётливо видимых на этом снимке верхних грудных позвонков. Для снижения несбалансированности обучающего набора все снимки были разделены по уровню жёсткости на 3 группы согласно медицинским критериям: мягкие (видно менее 3 позвонков), нормальные (видно 3"~4 позвонка) и жёсткие (видно более 4 позвонков).

Предобработка входных данных состояла из нескольких шагов:
\begin{enumerate}[beginpenalty=10000]
	\item автоматическое контрастирование изображения:
	\begin{equation}
		h \left( x \right) = 255 \cdot \frac{x - p_{0.5}}{p_{99.5} - p_{0.5}}, \nonumber
	\end{equation}
	где $x$ "--- значение интенсивности пикселя входного изображения, $p_{0.5}$ и $p_{99.5}$ "--- это 0.5\%"~ и 99.5\%"~процентили значений интенсивности всех пикселей изображения;
	\item автоматическая гамма-коррекция интенсивности пикселей изображения:
	\begin{equation}
		g \left( x \right) = 255 \cdot {\left( \frac{x}{255} \right)}^{\gamma}, \quad \gamma = \log_{\mu / 255}{0.5}, \nonumber
	\end{equation}
	где $\mu$ "--- средняя интенсивность всего изображения;
	\item уменьшение изображения до входного разрешения, используемого нейронной сетью (512х512 пикселей для модели ResNet"~18 и 384x384 пикселей для EfficientNetV2"~S).
	\item опциональный шаг глобальной или локальной (CLAHE) эквализации гистограммы. Размер стороны квадратного окна  в пикселях, используемого в методе локальной эквализации гистограммы, прямо зависит от размера стороны изображения и составляет $\frac{1}{2^n}$ от него, где $n\in\mathbb{N}$ "--- параметр метода. Влияние наличия этого шага и размера окна на качество работы алгоритма будет показано ниже.
\end{enumerate}

Для сохранения отношений упорядоченности между классами задача определения уровня жёсткости рентгеновского снимка рассматривалась как задача порядковой регрессии. На вход алгоритма поступает рентгеновский снимок грудной клетки и подвергается предобработке, затем при помощи нейронной сети ему ставится в соответствие вещественное число на отрезке $\left[0, 1\right]$, которое является внутренним безразмерным показателем жёсткости снимка, на основании которого после сравнения с настраиваемыми порогами изображение относится к одному из рассматриваемых классов жёсткости.  Пороги являются частью модели и настраиваются вместе с весами слоёв нейронной сети в процессе обучения. Преимуществом такого подхода является то, что с помощью внутреннего показателя жёсткости можно ранжировать изображения относительно друг друга даже в том случае, когда обрабатываемое изображение значительно отличается от обучающей выборки и для такого снимка пороги разделения классов жёсткости могут быть настроены неверно.

Набор рентгенограмм, использованный для обучения алгоритма, делился на обучающую, валидационную и тестовую выборку. Изображения обучающей выборки в процессе обучения подвергались случайным преобразованиям. Применялось взвешивание значений функции потерь для каждого примера обучающей выборки с весами, обратно пропорциональными количеству изображений соответствующего класса.

В качестве функции потерь в процессе обучения и валидации была выбрана функция потерь пороговой порядковой регрессии в виде суммы слагаемых, число которых зависит от числа классов (all"=threshold):

\begin{equation}
	\begin{cases}
		L \left( z, y \right) = \sum_{k=1}^{K-1} f \left( s \left( k, y \right) \cdot \left( \theta_k-z \right) \right), \\
		s \left( k, y \right) =
		\begin{cases}
			-1, k < y, \\
			+1, \ k \geq y,
		\end{cases}
	\end{cases} \nonumber
\end{equation}

\noindent где $z$ "--- выход нейронной сети (безразмерный показатель жёсткости), принимающий значения из отрезка $\left[ 0, 1 \right]$ (чем ближе к $1$, тем выше жёсткость снимка), $y$ "--- истинный класс соответствующего этому выходу изображения, $K$ "--- общее число классов, $\theta_1 < \theta_2 < \ldots < \theta_{K-1}$ "--- пороги, делящие действительную прямую на $K$ частей, а $f(x)$ "--- базовая функция потерь бинарной классификации, в качестве которой использовалась логистическая функция потерь:

\begin{equation}
	f \left( x \right) = \ln{\frac{1}{1+e^{-x}}}. \nonumber
\end{equation}

Результаты оценки жёсткости рентгенограмм были использованы для предварительной фильтрации обучающей выборки и входных данных нейросетевого алгоритма компьютерной диагностики туберкулёза лёгких по рентгеновским снимкам грудной клетки. Для создания и тестирования методов диагностики применялись 3 общедоступных наборов рентгенограмм грудной клетки здоровых и больных туберкулёзом лёгких пациентов.

На основании предсказанных величин жёсткости было проведено удаление из объединённого набора изображений одинаковой доли самых жёстких и самых мягких снимков (то есть с обеих сторон гистограммы распределения величин жёсткости). После этого качество обученного на прореженной обучающей выборке метода диагностики замерялось на прореженной тестовой выборке и сравнивалось с качеством работы на такой же тестовой выборке модели диагностики, обученной на непрореженной обучающей выборке.

Помимо прореживания выборок с обеих сторон гистограммы уровня жёсткости был рассмотрен и случай отбрасывания только самых жёстких снимков, так как на мягких снимках ещё могут сохраняться некоторые детали лёгочной ткани, в том время как на жёстких они могут быть полностью утеряны.

Значения сбалансированной точности, полученные в результате экспериментов представлены в Табл.~\ref{tab:synopsis-hardness-filtering-balacc}. Из неё видно, что изменение качества зависит от степени прореживания изображений, однако остаётся стабильно положительным. Сравнение более распространённых в медицине показателей чувствительности и специфичности для класса больных туберкулёзом пациентов приведено в Табл.~\ref{tab:synopsis-hardness-filtering-sens-spec}.

\begin{table} [htbp]%
	\centering
	\caption{Сравнение качества классификации моделей, обученных на полном и прореженном наборе (сбалансированная точность)}%
	\label{tab:synopsis-hardness-filtering-balacc}% label всегда желательно идти после caption
	\renewcommand{\arraystretch}{1.5}%% Увеличение расстояния между рядами, для улучшения восприятия.
	\begin{SingleSpace}
		\begin{tabulary}{\textwidth}{@{}@{\extracolsep{10pt}}cCCCCCC@{}} %Вертикальные полосы не используются принципиально, как и лишние горизонтальные (допускается по ГОСТ 2.105 пункт 4.4.5) % @{} позволяет прижиматься к краям
			\toprule     %%% верхняя линейка
			& \multicolumn{3}{@{}c@{}}{\makecell{Удаление жёстких и \\ мягких изображений}} & \multicolumn{3}{@{}c@{}}{\makecell{Удаление только \\ жёстких изображений}} \\
			\cmidrule(r){2-4}\cmidrule(l){5-7}
			Доля удалённых & 5\% & 10\% & 15\% & 5\% & 10\% & 15\% \\
			\midrule %%% тонкий разделитель. Отделяет названия столбцов. Обязателен по ГОСТ 2.105 пункт 4.4.5
			До & 0.958 & 0.951 & 0.951 & 0.962 & 0.961 & 0.965 \\
			После & 0.961 & 0.962 & 0.953 & 0.968 & 0.966 & 0.975 \\
			\bottomrule %%% нижняя линейка
		\end{tabulary}%
	\end{SingleSpace}
\end{table}

\begin{table} [htbp]%
	\centering
	\caption{Сравнение качества классификации моделей, обученных на полном и прореженном наборе (чувствительность~/~специфичность)}%
	\label{tab:synopsis-hardness-filtering-sens-spec}% label всегда желательно идти после caption
	\renewcommand{\arraystretch}{1.5}%% Увеличение расстояния между рядами, для улучшения восприятия.
	\begin{SingleSpace}
		\begin{tabulary}{\textwidth}{@{}@{\extracolsep{10pt}}cCCCCCC@{}} %Вертикальные полосы не используются принципиально, как и лишние горизонтальные (допускается по ГОСТ 2.105 пункт 4.4.5) % @{} позволяет прижиматься к краям
			\toprule     %%% верхняя линейка
			& \multicolumn{3}{@{}c@{}}{\makecell{Удаление жёстких и \\ мягких изображений}} & \multicolumn{3}{@{}c@{}}{\makecell{Удаление только \\ жёстких изображений}} \\
			\cmidrule(r){2-4}\cmidrule(l){5-7}
			Доля удалённых & 5\% & 10\% & 15\% & 5\% & 10\% & 15\% \\
			\midrule %%% тонкий разделитель. Отделяет названия столбцов. Обязателен по ГОСТ 2.105 пункт 4.4.5
			До & 0.923/ 0.994 & 0.909/ 0.994 & 0.908/ 0.995 & 0.930/ 0.994 & 0.927/ 0.995 & 0.934/ 0.996 \\
			После & 0.933/ 0.990 & 0.933/ 0.991 & 0.915/ 0.990 & 0.943/ 0.994 & 0.941/ 0.992 & 0.958/ 0.993 \\
			\bottomrule %%% нижняя линейка
		\end{tabulary}%
	\end{SingleSpace}
\end{table}

Разработанный метод определения жёсткости позволяет увеличить качество работы алгоритма диагностики туберкулёза лёгких при условии предварительной фильтрации изображений перед обучением классификатора и получением предсказаний. Снижение разброса жёсткости данных и увеличение их однородности заметно повысило точность обнаружения больных пациентов при сохранении или малом снижении специфичности.


%TODO Глава 4
{\textbf{Четвёртая}} глава посвящена программной реализации алгоритмов, разработанных в предыдущих главах. Описывается разработанный программный комплекс, состоящий из трёх различных программных модулей:
\begin{enumerate}[beginpenalty=10000]
	\item модуль повышения разрешения изображений мигающей флуоресцентной микроскопии;
	
	\item модуль повышения резкости медицинских изображений методом деформации пиксельной сетки;
	
	\item модуль анализа и обработки рентгенограмм грудной клетки.
\end{enumerate}

Представлено описание интерфейса программных модулей. Программная реализация модулей выполнялась на языке программирования Python~3 с применением программных библиотек для работы с математическими функциями, векторными вычислениями и машинного обучения.

Кроме того, приводится описание сформированного в ходе выполнения работы набора рентгенограмм грудной клетки для задачи компьютерной диагностики туберкулёза и демонстрируется возможность повысить с его помощью качество диагностики для некоторых нейросетевых алгоритмов.


%TODO: Заключение
\FloatBarrier
\pdfbookmark{Заключение}{conclusion}                                  % Закладка pdf
В \textbf{заключении} формулируются основные результаты работы.
%\input{common/concl}

\pdfbookmark{Литература}{bibliography}                                % Закладка pdf

\ifdefmacro{\microtypesetup}{\microtypesetup{protrusion=false}}{} % не рекомендуется применять пакет микротипографики к автоматически генерируемому списку литературы
\urlstyle{rm}                               % ссылки URL обычным шрифтом
\newrefsection
\nocite{krylov2017single}
\nocite{krylov2018grid171613482}
\nocite{krylovpost}
\nocite{pchelintsev2019enhancement}
\nocite{krylov2021regularization386034310}
\nocite{dovganich2022automatic}
\nocite{pchelintsev2023hardness}
\nocite{pchelintsev2023robustness}
\insertbiblioauthorgroupeddd
%\ifnumequal{\value{bibliosel}}{0}{% Встроенная реализация с загрузкой файла через движок bibtex8
%    \renewcommand{\bibname}{\large \bibtitleauthor}
%    \nocite{*}
%    \insertbiblioauthor           % Подключаем Bib-базы
%    %\insertbiblioexternal   % !!! bibtex не умеет работать с несколькими библиографиями !!!
%}{% Реализация пакетом biblatex через движок biber
%    % Цитирования.
%    %  * Порядок перечисления определяет порядок в библиографии (только внутри подраздела, если `\insertbiblioauthorgrouped`).
%    %  * Если не соблюдать порядок "как для \printbibliography", нумерация в `\insertbiblioauthor` будет кривой.
%    %  * Если цитировать каждый источник отдельной командой --- найти некоторые ошибки будет проще.
%    %
%    %% authorvak
%%    \nocite{vakbib1}%
%%    \nocite{vakbib2}%
%    %
%    %% authorwos
%%    \nocite{wosbib1}%
%    %
%    %% authorscopus
%%    \nocite{scbib1}%
%    %
%    %% authorpathent
%%    \nocite{patbib1}%
%    %
%    %% authorprogram
%%    \nocite{progbib1}%
%    %
%    %% authorconf
%%    \nocite{confbib1}%
%%    \nocite{confbib2}%
%    %
%    %% authorother
%%    \nocite{bib1}%
%%    \nocite{bib2}%
%    
%    \nocite{krylov2017single}
%    \nocite{krylov2018grid171613482}
%    \nocite{krylovpost}
%    \nocite{pchelintsev2019enhancement}
%    \nocite{krylov2021regularization386034310}
%    \nocite{dovganich2022automatic}
%    \nocite{pchelintsev2023hardness}
%    \nocite{pchelintsev2023robustness}
%    \insertbiblioauthorgrouped
%
%%    \ifnumgreater{\value{usefootcite}}{0}{
%%        \begin{refcontext}[labelprefix={}]
%%            \ifnum \value{bibgrouped}>0
%%                \insertbiblioauthorgrouped    % Вывод всех работ автора, сгруппированных по источникам
%%            \else
%%                \insertbiblioauthor      % Вывод всех работ автора
%%            \fi
%%        \end{refcontext}
%%    }{
%%        \ifnum \totvalue{citeexternal}>0
%%            \begin{refcontext}[labelprefix=A]
%%                \ifnum \value{bibgrouped}>0
%%                    \insertbiblioauthorgrouped    % Вывод всех работ автора, сгруппированных по источникам
%%                \else
%%                    \insertbiblioauthor      % Вывод всех работ автора
%%                \fi
%%            \end{refcontext}
%%        \else
%%            \ifnum \value{bibgrouped}>0
%%                \insertbiblioauthorgrouped    % Вывод всех работ автора, сгруппированных по источникам
%%            \else
%%                \insertbiblioauthor      % Вывод всех работ автора
%%            \fi
%%        \fi
%%        %  \insertbiblioauthorimportant  % Вывод наиболее значимых работ автора (определяется в файле characteristic во второй section)
%%        \begin{refcontext}[labelprefix={}]
%%            \insertbiblioexternal            % Вывод списка литературы, на которую ссылались в тексте автореферата
%%        \end{refcontext}
%%        % Невидимый библиографический список для подсчёта количества внешних публикаций
%%        % Используется, чтобы убрать приставку "А" у работ автора, если в автореферате нет
%%        % цитирований внешних источников.
%%        \printbibliography[heading=nobibheading, section=0, env=countexternal, keyword=biblioexternal, resetnumbers=true]%
%%    }
%}
\ifdefmacro{\microtypesetup}{\microtypesetup{protrusion=true}}{}
\urlstyle{tt}                               % возвращаем установки шрифта ссылок URL
